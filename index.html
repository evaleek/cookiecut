<!DOCTYPE html>
<html lang="en" style="height:100%;">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CookieCut</title>
</head>
<body>
    <script type="module" src="./cookiecut.js"></script>
    <script type="module">
        import * as cc from './cookiecut.js';

        const image = document.getElementById("userImage");
        const imageUpload = document.getElementById("userImageUpload");
        const cellSize = document.getElementById("cellSize");
        const canvas = document.getElementById("canvas");

        // TODO check for WebGL support and fail clearly to user

        cc.init(canvas);
        cc.setCellSize(cellSize.value);
        imageUpload.addEventListener("change", onImageUpload);
        cellSize.addEventListener("change", (e) => {
            cc.setCellSize(e.target.value);
        });

        function onImageUpload() {
            const len = this.files.length;
            if (len == 1 && this.files[0].type.startsWith("image/")) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    image.src = e.target.result;
                    image.onload = function() {
                        cc.setImage(image);
                        canvas.style.display = "inline";
                    };
                };
                // TODO handle read failure
                reader.readAsDataURL(this.files[0]);
            } else {
                image.src = '';
                cc.setImage(null);
                canvas.style.display = "none";
                if (len > 1) {
                    console.error("unexpected file upload count " + len);
                }
            }
        }
    </script>
    <img id="userImage">
    <input type="number" id="cellSize" min="4" step="1" value="8">
    <input type="file" id="userImageUpload" accept="image/*">
    <canvas id="canvas"></canvas>
</body>
</html>
